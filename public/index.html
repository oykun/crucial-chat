<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oykun OS</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto Mono', monospace;
            /* Custom wallpaper image */
            background: url('assets/wallpapers/wallpaper.png') no-repeat center center fixed;
            background-size: cover;
            color: #000000;
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* Desktop */
        .desktop {
            position: fixed;
            top: 32px;
            left: 0;
            width: 100%;
            height: calc(100% - 32px);
            cursor: default;
        }
        
        /* Context Menu */
        .context-menu {
            position: fixed;
            background: #FFFFFF;
            border: 1px solid #E0E0E0;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 4px 0;
            min-width: 160px;
            z-index: 2000;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 16px;
            font-size: 12px;
            color: #333333;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .context-menu-item:hover {
            background: #F8F8F8;
            color: #FF3B30;
        }
        
        .context-menu-item.disabled {
            color: #999999;
            cursor: not-allowed;
        }
        
        .context-menu-item.disabled:hover {
            background: transparent;
            color: #999999;
        }
        
        .context-menu-separator {
            height: 1px;
            background: #E0E0E0;
            margin: 4px 0;
        }
        
        /* Window */
        .window {
            position: absolute;
            background: transparent;
            border-radius: 32px;
            border: 8px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1;
            transition: z-index 0s;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        
        .window.active {
            z-index: 10;
        }
        
        .window.minimized {
            display: none;
        }
        
        .window-resize-handle {
            position: absolute;
            z-index: 10;
        }
        
        .window-resize-handle.nw {
            top: 0;
            left: 0;
            width: 12px;
            height: 12px;
            cursor: nw-resize;
        }
        
        .window-resize-handle.ne {
            top: 0;
            right: 0;
            width: 12px;
            height: 12px;
            cursor: ne-resize;
        }
        
        .window-resize-handle.sw {
            bottom: 0;
            left: 0;
            width: 12px;
            height: 12px;
            cursor: sw-resize;
        }
        
        .window-resize-handle.se {
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            cursor: se-resize;
        }
        
        .window-resize-handle.n {
            top: 0;
            left: 12px;
            right: 12px;
            height: 12px;
            cursor: n-resize;
        }
        
        .window-resize-handle.s {
            bottom: 0;
            left: 12px;
            right: 12px;
            height: 12px;
            cursor: s-resize;
        }
        
        .window-resize-handle.w {
            top: 12px;
            bottom: 12px;
            left: 0;
            width: 12px;
            cursor: w-resize;
        }
        
        .window-resize-handle.e {
            top: 12px;
            bottom: 12px;
            right: 0;
            width: 12px;
            cursor: e-resize;
        }
        
        /* Title bar */
        .title-bar {
            height: 36px;
            background: rgba(248, 248, 248, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(224, 224, 224, 0.4);
            display: flex;
            align-items: center;
            padding: 0 16px;
            cursor: move;
        }
        
        .window-controls {
            display: flex;
            gap: 8px;
        }
        
        .window-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid #D0D0D0;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .window-btn.close {
            background: linear-gradient(135deg, #FF5F57 0%, #FF3B30 100%);
            border-color: #E73C2E;
        }
        
        .window-btn.close:hover {
            background: linear-gradient(135deg, #FF6B63 0%, #FF4A40 100%);
            border-color: #FF3B30;
        }
        
        .window-btn.maximize {
            background: linear-gradient(135deg, #28CA42 0%, #1DB954 100%);
            border-color: #1DB954;
        }
        
        .window-btn.maximize:hover {
            background: linear-gradient(135deg, #32D452 0%, #22C55E 100%);
            border-color: #1DB954;
        }
        
        .window-title {
            flex: 1;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
        }
        
        /* Notes content */
        .notes-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            background: #FFFFFF;
            border-radius: 0 0 24px 24px;
        }
        
        .notes-text {
            font-size: 12px;
            line-height: 1.8;
            color: #333333;
            padding: 40px;
            font-family: 'Roboto Mono', monospace;
            white-space: pre-wrap;
        }
        
        .notes-text a {
            color: #FF3B30;
            text-decoration: none;
            border-bottom: 1px solid #FF3B30;
            transition: opacity 0.2s ease;
        }
        
        .notes-text a:hover {
            opacity: 0.7;
        }
        
        .divider {
            border-bottom: 1px solid #E0E0E0;
            margin: 20px 0;
        }
        
        /* Highlight */
        .highlight {
            color: #FF3B30;
            font-weight: 600;
        }
        
        /* Mail content */
        .mail-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            background: #FFFFFF;
            border-radius: 0 0 24px 24px;
        }
        
        .mail-form {
            padding: 40px;
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
        }
        
        .mail-field {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .mail-field label {
            color: #666666;
            font-weight: 500;
        }
        
        .mail-field input,
        .mail-field textarea {
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            padding: 12px 16px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            background: #FFFFFF;
            color: #333333;
            outline: none;
            transition: border-color 0.2s ease;
        }
        
        .mail-field input:focus,
        .mail-field textarea:focus {
            border-color: #FF0000;
        }
        
        .mail-field input[readonly] {
            background: #F8F8F8;
            color: #999999;
            cursor: not-allowed;
        }
        
        .mail-field textarea {
            resize: vertical;
            min-height: 200px;
            line-height: 1.6;
        }
        
        .mail-body {
            flex: 1;
        }
        
        .mail-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .mail-send-btn {
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            padding: 12px 32px;
            background: #FF0000;
            color: #FFFFFF;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s ease;
        }
        
        .mail-send-btn:hover {
            background: #CC0000;
        }
        
        .mail-send-btn:disabled {
            background: #CCCCCC;
            cursor: not-allowed;
        }
        
        .mail-status {
            font-size: 12px;
            color: #666666;
        }
        
        .mail-status.success {
            color: #00AA00;
        }
        
        .mail-status.error {
            color: #FF0000;
        }
        
        /* Dragging */
        .dragging {
            cursor: grabbing !important;
        }
        
        /* Menu bar */
        .menu-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 32px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            z-index: 1000;
            border-bottom: 1px solid rgba(224, 224, 224, 0.5);
            font-size: 13px;
        }
        
        .menu-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .menu-items {
            display: flex;
            gap: 16px;
        }
        
        .menu-item {
            font-size: 12px;
            font-weight: 500;
            color: #000000;
            cursor: pointer;
            transition: color 0.2s ease;
            position: relative;
        }
        
        .menu-item:hover {
            color: #FF3B30;
        }
        
        .menu-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: #FFFFFF;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 120px;
            z-index: 1001;
            display: none;
        }
        
        .menu-dropdown.show {
            display: block;
        }
        
        .menu-dropdown-item {
            padding: 8px 12px;
            font-size: 12px;
            color: #000000;
            cursor: pointer;
            transition: background 0.2s ease;
            border-bottom: 1px solid #F0F0F0;
        }
        
        .menu-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .menu-dropdown-item:hover {
            background: #F8F8F8;
            color: #FF3B30;
        }
        
        /* Settings Window Styles */
        .settings-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            background: #FFFFFF;
            border-radius: 0 0 24px 24px;
        }
        
        .settings-tabs {
            display: flex;
            border-bottom: 1px solid #E0E0E0;
            background: #F8F8F8;
        }
        
        .settings-tab {
            padding: 12px 20px;
            font-size: 12px;
            font-weight: 500;
            color: #666666;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .settings-tab:hover {
            color: #333333;
            background: #F0F0F0;
        }
        
        .settings-tab.active {
            color: #333333;
            background: #FFFFFF;
            border-bottom-color: #FF3B30;
        }
        
        .settings-panel {
            padding: 24px;
        }
        
        .settings-section h3 {
            font-size: 14px;
            font-weight: 600;
            color: #333333;
            margin-bottom: 16px;
        }
        
        .settings-section p {
            font-size: 12px;
            color: #666666;
            line-height: 1.5;
        }
        
        .wallpaper-options {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .wallpaper-option {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 8px;
        }
        
        .wallpaper-option:hover {
            border-color: #E0E0E0;
        }
        
        .wallpaper-option.selected {
            border-color: #FF3B30;
        }
        
        .wallpaper-preview {
            width: 120px;
            height: 80px;
            border-radius: 6px;
            border: 1px solid #E0E0E0;
            margin-bottom: 8px;
        }
        
        .vibrant-preview {
            background: url('assets/wallpapers/wallpaper.png') no-repeat center center;
            background-size: cover;
        }
        
        .black-preview {
            background: #000000;
        }
        
        .gray-preview {
            background: #F5F5F5;
        }
        
        .pastel-preview {
            background: linear-gradient(135deg, #FFE5E5 0%, #E5F3FF 50%, #F0E5FF 100%);
        }
        
        .wallpaper-label {
            font-size: 11px;
            font-weight: 500;
            color: #333333;
            text-align: center;
        }
        
        /* Web Window Styles */
        .web-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #FFFFFF;
            border-radius: 0 0 24px 24px;
        }
        
        .web-toolbar {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #F8F8F8;
            border-bottom: 1px solid #E0E0E0;
            gap: 8px;
        }
        
        .web-nav-buttons {
            display: flex;
            gap: 4px;
        }
        
        .web-nav-btn, .web-action-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #E0E0E0;
            background: #FFFFFF;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .web-nav-btn:hover, .web-action-btn:hover {
            background: #F0F0F0;
        }
        
        .web-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .web-address-bar {
            flex: 1;
            display: flex;
            gap: 8px;
        }
        
        .web-address-bar input {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid #E0E0E0;
            border-radius: 16px;
            background: #FFFFFF;
            font-size: 12px;
            outline: none;
        }
        
        .web-address-bar input:focus {
            border-color: #FF3B30;
        }
        
        .web-external-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #E0E0E0;
            background: #FFFFFF;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .web-external-btn:hover {
            background: #F0F0F0;
        }
        
        .web-favorites-bar {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            background: #F8F8F8;
            border-bottom: 1px solid #E0E0E0;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .fav-link {
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            color: #333333;
            font-size: 12px;
            font-weight: 500;
            padding: 4px 0;
            transition: color 0.2s ease;
            white-space: nowrap;
        }
        
        .fav-link:hover {
            color: #FF3B30;
        }
        
        .fav-icon {
            width: 16px;
            height: 16px;
            border-radius: 2px;
        }
        
        .fav-folder {
            position: relative;
        }
        
        .fav-folder-header {
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            color: #333333;
            font-size: 12px;
            font-weight: 500;
            padding: 4px 0;
            transition: color 0.2s ease;
            white-space: nowrap;
        }
        
        .fav-folder-header:hover {
            color: #FF3B30;
        }
        
        .fav-folder-arrow {
            font-size: 10px;
            transition: transform 0.2s ease;
        }
        
        .fav-folder.open .fav-folder-arrow {
            transform: rotate(180deg);
        }
        
        .fav-folder-content {
            position: absolute;
            top: 100%;
            left: 0;
            background: #FFFFFF;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 140px;
            margin-top: 4px;
            padding: 4px 0;
        }
        
        .fav-folder-content .fav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            margin: 0;
            border-bottom: 1px solid #F0F0F0;
        }
        
        .fav-folder-content .fav-link:last-child {
            border-bottom: none;
        }
        
        .fav-folder-content .fav-link:hover {
            background: #F8F8F8;
        }
        
        .web-body {
            flex: 1;
            overflow: hidden;
        }
        
        .web-favorites {
            padding: 40px;
            height: 100%;
            overflow-y: auto;
        }
        
        .web-favorites h2 {
            font-size: 18px;
            font-weight: 600;
            color: #333333;
            margin-bottom: 32px;
            text-align: center;
        }
        
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 24px;
            width: 100%;
        }
        
        .favorite-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .favorite-item:hover {
            transform: translateY(-2px);
        }
        
        .favorite-icon {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #F5F5F5;
            border: 1px solid #E0E0E0;
        }
        
        .favorite-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }
        
        .favorite-fallback {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            color: #666666;
            background: #F5F5F5;
            border-radius: 12px;
        }
        
        .favorite-label {
            font-size: 12px;
            font-weight: 500;
            color: #333333;
            text-align: center;
            line-height: 1.3;
        }
        
        .web-iframe-container {
            height: 100%;
            width: 100%;
        }
        
        /* Music Player Styles */
        .music-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #FFFFFF;
            padding: 0;
            overflow: hidden;
            border-radius: 0 0 24px 24px;
        }
        
        .music-player {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #FFFFFF;
        }
        
        .video-section {
            flex: 1;
            position: relative;
            background: #000000;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .video-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            font-size: 11px;
        }
        
        .video-title {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .video-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .video-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            padding: 2px 6px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s ease;
        }
        
        .video-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .video-filename {
            color: #ccc;
            font-size: 10px;
        }
        
        .video-dimensions {
            color: #999;
            margin-left: auto;
            font-size: 10px;
        }
        
        .music-controls {
            background: #FFFFFF;
            border-top: 1px solid #E0E0E0;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .track-info {
            display: flex;
            flex-direction: column;
            gap: 0px;
            min-width: 70px;
        }
        
        .track-title {
            font-weight: 600;
            font-size: 11px;
            color: #333;
        }
        
        .track-artist {
            font-size: 9px;
            color: #666;
        }
        
        
        .control-buttons {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: auto;
        }
        
        .control-btn {
            background: #F8F8F8;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s ease;
            color: #333;
        }
        
        .control-btn:hover {
            background: #F0F0F0;
            border-color: #D0D0D0;
        }
        
        .control-btn:active {
            transform: translateY(1px);
        }
        
        .play-btn {
            background: #FF3B30;
            border-color: #FF3B30;
            color: white;
        }
        
        .play-btn:hover {
            background: #E0342A;
            border-color: #E0342A;
        }
        
        .pause-btn {
            background: #F8F8F8;
            border-color: #E0E0E0;
            color: #333;
        }
        
        .prev-btn, .next-btn {
            background: #F8F8F8;
            border-color: #E0E0E0;
            color: #333;
        }
        
        
        
        .menu-right {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 12px;
        }
        
        .menu-time {
            font-weight: 500;
        }
        
        /* Widget base */
        .widget {
            background: #FFFFFF;
            border-radius: 24px;
            padding: 24px;
            position: relative;
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        .widget:hover {
            transform: translateY(-4px);
        }
        
        /* Dot matrix pattern */
        .dot-pattern {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: grid;
            grid-template-columns: repeat(8, 8px);
            gap: 4px;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            background: #000000;
            border-radius: 50%;
        }
        
        /* Large red widget */
        .widget-large {
            grid-column: span 2;
            grid-row: span 2;
            background: #FF3B30;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .widget-large::before {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .widget-icon {
            font-size: 48px;
            position: relative;
            z-index: 1;
        }
        
        /* App widgets */
        .widget-app {
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .widget-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .widget-desc {
            font-size: 11px;
            color: #666666;
            line-height: 1.5;
            margin-bottom: 16px;
        }
        
        .widget-action {
            font-size: 20px;
            text-align: right;
        }
        
        /* Dark widget */
        .widget-dark {
            background: #1C1C1E;
            color: #FFFFFF;
        }
        
        .widget-dark .widget-desc {
            color: #999999;
        }
        
        /* Compass widget */
        .compass {
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .compass-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 2px solid #E0E0E0;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .compass-dot {
            position: absolute;
            display: grid;
            grid-template-columns: repeat(3, 6px);
            gap: 3px;
        }
        
        .compass-dot .dot {
            width: 6px;
            height: 6px;
        }
        
        .compass-n { top: 10px; }
        .compass-s { bottom: 10px; }
        .compass-w { left: 10px; }
        .compass-e { right: 10px; }
        
        .compass-label {
            position: absolute;
            font-size: 10px;
            font-weight: 600;
        }
        
        .label-n { top: -20px; }
        .label-s { bottom: -20px; }
        .label-w { left: -20px; }
        .label-e { right: -20px; }
        
        /* Status text widget */
        .status-text {
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            letter-spacing: 0.5px;
        }
        
        /* Time display */
        .time-display {
            font-size: 12px;
            font-weight: 300;
            text-align: center;
            padding: 40px 0;
        }
        
        /* Emoji widget */
        .emoji-widget {
            font-size: 72px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 140px;
        }
        
        /* Red accent */
        .accent-red {
            color: #FF3B30;
        }
        
        /* WIP badge */
        .wip-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #FF3B30;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        /* Dock */
        .dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            align-items: flex-end;
            z-index: 1000;
        }
        
        .dock-item {
            background: #FFFFFF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 1px solid transparent;
            width: 60px;
            height: 60px;
        }
        
        
        .dock-label {
            font-size: 10px;
            font-weight: 500;
            color: #333333;
            white-space: nowrap;
        }
        
        .dock-item:hover {
            transform: translateY(-8px) scale(1.05);
            border-color: #FF3B30;
        }
        
        .dock-item:hover .dock-label {
            color: #FF3B30;
        }
        
        .dock-item.active {
            border-color: #FF3B30;
        }
        
        .dock-item.active .dock-label {
            color: #FF3B30;
        }
        
        .dock-item.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: #FF3B30;
            border-radius: 50%;
        }
        
        .dock-divider {
            width: 1px;
            height: 40px;
            background: #E0E0E0;
            margin: 0 4px;
        }
        
        @media (max-width: 768px) {
            .menu-items {
                display: none;
            }
            
            .dock {
                bottom: 10px;
            }
            
            .dock-item {
                padding: 12px;
                width: 50px;
                height: 50px;
            }
            
            .dock-label {
                font-size: 9px;
            }
        }
    </style>
</head>
<body>
    <!-- Menu Bar -->
    <div class="menu-bar">
        <div class="menu-left">
            <div class="menu-items">
                <div class="menu-item" id="oykunOSMenu">
                    Oykun OS
                    <div class="menu-dropdown" id="oykunOSDropdown">
                        <div class="menu-dropdown-item" onclick="openAbout()">About</div>
                        <div class="menu-dropdown-item" onclick="openSettings()">Settings</div>
                    </div>
                </div>
            </div>
        </div>
            <div class="menu-right">
                <div class="menu-time" id="menuTime">00:00</div>
            </div>
        </div>
        
    <!-- Desktop -->
    <div class="desktop" id="desktop">
        <!-- Context Menu -->
        <div class="context-menu" id="contextMenu">
            <div class="context-menu-item" id="aboutContextItem">
                About Oykun OS
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" id="wallpaperContextItem">
                Change Wallpaper
            </div>
        </div>
        
        <!-- Messages Window -->
        <div class="window minimized" id="oykunaiWindow" style="top: 50px; right: 80px; left: auto; width: 420px; height: calc(100vh - 140px);">
            <div class="title-bar" id="oykunaiTitleBar">
                <div class="window-controls">
                    <div class="window-btn close" data-window="oykunaiWindow"></div>
                    <div class="window-btn maximize" data-window="oykunaiWindow"></div>
                </div>
                <div class="window-title">Chat</div>
                <div style="width: 36px;"></div>
            </div>
            <div style="flex: 1; overflow: hidden; position: relative;">
                <iframe src="oykunai/" style="width: 100%; height: 100%; border: none; display: block;"></iframe>
                <div class="window-resize-handle nw" data-window="oykunaiWindow" data-direction="nw"></div>
                <div class="window-resize-handle ne" data-window="oykunaiWindow" data-direction="ne"></div>
                <div class="window-resize-handle sw" data-window="oykunaiWindow" data-direction="sw"></div>
                <div class="window-resize-handle se" data-window="oykunaiWindow" data-direction="se"></div>
                <div class="window-resize-handle n" data-window="oykunaiWindow" data-direction="n"></div>
                <div class="window-resize-handle s" data-window="oykunaiWindow" data-direction="s"></div>
                <div class="window-resize-handle w" data-window="oykunaiWindow" data-direction="w"></div>
                <div class="window-resize-handle e" data-window="oykunaiWindow" data-direction="e"></div>
            </div>
        </div>
        
        <!-- Mail Window -->
        <div class="window minimized" id="mailWindow" style="top: 100px; left: 50%; transform: translateX(-50%); width: 600px; height: 500px;">
            <div class="title-bar" id="mailTitleBar">
                <div class="window-controls">
                    <div class="window-btn close" data-window="mailWindow"></div>
                    <div class="window-btn maximize" data-window="mailWindow"></div>
                </div>
                <div class="window-title">Mail</div>
                <div style="width: 36px;"></div>
            </div>
            <div class="mail-content">
                <form id="mailForm" class="mail-form">
                    <div class="mail-field">
                        <label>To:</label>
                        <input type="text" value="hello@oykun.com" readonly>
                    </div>
                    <div class="mail-field">
                        <label>From:</label>
                        <input type="email" id="mailFrom" placeholder="your@email.com" required>
                    </div>
                    <div class="mail-field">
                        <label>Subject:</label>
                        <input type="text" id="mailSubject" placeholder="Enter subject" required>
                    </div>
                    <div class="mail-field mail-body">
                        <label>Message:</label>
                        <textarea id="mailBody" placeholder="Write your message..." required></textarea>
                    </div>
                    <div class="mail-actions">
                        <button type="submit" class="mail-send-btn">Send</button>
                        <div id="mailStatus" class="mail-status"></div>
                    </div>
                </form>
                <div class="window-resize-handle nw" data-window="mailWindow" data-direction="nw"></div>
                <div class="window-resize-handle ne" data-window="mailWindow" data-direction="ne"></div>
                <div class="window-resize-handle sw" data-window="mailWindow" data-direction="sw"></div>
                <div class="window-resize-handle se" data-window="mailWindow" data-direction="se"></div>
                <div class="window-resize-handle n" data-window="mailWindow" data-direction="n"></div>
                <div class="window-resize-handle s" data-window="mailWindow" data-direction="s"></div>
                <div class="window-resize-handle w" data-window="mailWindow" data-direction="w"></div>
                <div class="window-resize-handle e" data-window="mailWindow" data-direction="e"></div>
            </div>
        </div>
        
        <!-- About Window -->
        <div class="window active" id="aboutWindow" style="top: 80px; left: 120px; width: 650px; height: 550px;">
            <div class="title-bar" id="aboutTitleBar">
                <div class="window-controls">
                    <div class="window-btn close" data-window="aboutWindow"></div>
                    <div class="window-btn maximize" data-window="aboutWindow"></div>
                </div>
                <div class="window-title">About Oykun OS</div>
                <div style="width: 36px;"></div>
            </div>
            <div class="notes-content">
                <div class="notes-text">
Welcome to Oykun's AI Lab

This is my playground for exploring AI-assisted creativity, design thinking, human-computer interaction and more...

<strong>Apps</strong>

üí¨ Chat
Chat with an AI trained on my design philosophy, articles, and insights.
Ask about design, business, or the creative process.

üåê Web
A Safari-like browser built into Oykun OS. Browse the web with favorites,
address bar navigation, and seamless integration within the desktop environment.

‚è≥ More Coming Soon
Always experimenting with new ideas.


<strong>Connect</strong>

‚Üí Follow me on X: <a href="https://x.com/oykun" target="_blank">x.com/oykun</a>

‚Üí Need design help? <a href="https://crucial.design" target="_blank">crucial.design</a>
                </div>
                <div class="window-resize-handle nw" data-window="aboutWindow" data-direction="nw"></div>
                <div class="window-resize-handle ne" data-window="aboutWindow" data-direction="ne"></div>
                <div class="window-resize-handle sw" data-window="aboutWindow" data-direction="sw"></div>
                <div class="window-resize-handle se" data-window="aboutWindow" data-direction="se"></div>
                <div class="window-resize-handle n" data-window="aboutWindow" data-direction="n"></div>
                <div class="window-resize-handle s" data-window="aboutWindow" data-direction="s"></div>
                <div class="window-resize-handle w" data-window="aboutWindow" data-direction="w"></div>
                <div class="window-resize-handle e" data-window="aboutWindow" data-direction="e"></div>
            </div>
        </div>
        
        <!-- Web Window -->
        <div class="window minimized" id="webWindow" style="top: 60px; left: 100px; width: 1200px; height: 800px;">
            <div class="title-bar" id="webTitleBar">
                <div class="window-controls">
                    <div class="window-btn close" data-window="webWindow"></div>
                    <div class="window-btn maximize" data-window="webWindow"></div>
                </div>
                <div class="window-title">Web</div>
                <div style="width: 36px;"></div>
            </div>
            <div class="web-content">
                <div class="web-toolbar">
                    <div class="web-nav-buttons">
                        <button class="web-nav-btn" id="webHomeBtn">‚åÇ</button>
                        <button class="web-nav-btn" id="webBackBtn" disabled>‚Üê</button>
                        <button class="web-nav-btn" id="webForwardBtn" disabled>‚Üí</button>
                        <button class="web-nav-btn" id="webRefreshBtn">‚Üª</button>
                    </div>
                    <div class="web-address-bar">
                        <input type="text" id="webAddressInput" placeholder="Search or enter website name" value="">
                        <button class="web-external-btn" id="webExternalBtn">‚Üó</button>
                    </div>
                </div>
                <div class="web-favorites-bar">
                    <a href="#" class="fav-link" data-url="https://oykun.com">
                        <img src="https://www.google.com/s2/favicons?domain=oykun.com&sz=16" alt="Oykun's Blog" class="fav-icon">
                        <span>Oykun's Blog</span>
                    </a>
                    <a href="#" class="fav-link" data-url="https://crucial.design">
                        <img src="https://www.google.com/s2/favicons?domain=crucial.design&sz=16" alt="Crucial.Design" class="fav-icon">
                        <span>Crucial.Design</span>
                    </a>
                    <div class="fav-folder">
                        <a href="#" class="fav-folder-header" id="toolsFolderHeader">
                            <span>Tools</span>
                            <span class="fav-folder-arrow">‚ñº</span>
                        </a>
                        <div class="fav-folder-content" id="toolsFolderContent" style="display: none;">
                            <a href="#" class="fav-link" data-url="http://mobbin.com/?via=oykun">
                                <img src="https://www.google.com/s2/favicons?domain=mobbin.com&sz=16" alt="Mobbin" class="fav-icon">
                                <span>Mobbin</span>
                            </a>
                            <a href="#" class="fav-link" data-url="https://psxid.figma.com/l16yu2303itm">
                                <img src="https://www.google.com/s2/favicons?domain=figma.com&sz=16" alt="Figma" class="fav-icon">
                                <span>Figma</span>
                            </a>
                            <a href="#" class="fav-link" data-url="https://www.framer.com/?via=oykun33">
                                <img src="https://www.google.com/s2/favicons?domain=framer.com&sz=16" alt="Framer" class="fav-icon">
                                <span>Framer</span>
                            </a>
                            <a href="#" class="fav-link" data-url="https://affiliate.notion.so/61qajp7ha2th">
                                <img src="https://www.google.com/s2/favicons?domain=notion.so&sz=16" alt="Notion" class="fav-icon">
                                <span>Notion</span>
                            </a>
                            <a href="#" class="fav-link" data-url="http://cursor.com">
                                <img src="https://www.google.com/s2/favicons?domain=cursor.com&sz=16" alt="Cursor AI" class="fav-icon">
                                <span>Cursor AI</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="web-body">
                    <div class="web-favorites" id="webFavorites">
                        <h2>Favorites</h2>
                        <div class="favorites-grid">
                            <div class="favorite-item" data-url="https://oykun.com">
                                <div class="favorite-icon">
                                    <img src="https://www.google.com/s2/favicons?domain=oykun.com&sz=64" alt="Oykun's Blog" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="favorite-fallback" style="display: none;">O</div>
                                </div>
                                <div class="favorite-label">Oykun's Blog</div>
                            </div>
                            <div class="favorite-item" data-url="https://crucial.design">
                                <div class="favorite-icon">
                                    <img src="https://www.google.com/s2/favicons?domain=crucial.design&sz=64" alt="Crucial.Design" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="favorite-fallback" style="display: none;">C</div>
                                </div>
                                <div class="favorite-label">Crucial.Design</div>
                            </div>
                            <div class="favorite-item" data-url="http://mobbin.com/?via=oykun">
                                <div class="favorite-icon">
                                    <img src="https://www.google.com/s2/favicons?domain=mobbin.com&sz=64" alt="Mobbin" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="favorite-fallback" style="display: none;">M</div>
                                </div>
                                <div class="favorite-label">Mobbin</div>
                            </div>
                            <div class="favorite-item" data-url="https://psxid.figma.com/l16yu2303itm">
                                <div class="favorite-icon">
                                    <img src="https://www.google.com/s2/favicons?domain=figma.com&sz=64" alt="Figma" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="favorite-fallback" style="display: none;">F</div>
                                </div>
                                <div class="favorite-label">Figma</div>
                            </div>
                            <div class="favorite-item" data-url="https://www.framer.com/?via=oykun33">
                                <div class="favorite-icon">
                                    <img src="https://www.google.com/s2/favicons?domain=framer.com&sz=64" alt="Framer" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="favorite-fallback" style="display: none;">F</div>
                                </div>
                                <div class="favorite-label">Framer</div>
                            </div>
                            <div class="favorite-item" data-url="https://affiliate.notion.so/61qajp7ha2th">
                                <div class="favorite-icon">
                                    <img src="https://www.google.com/s2/favicons?domain=notion.so&sz=64" alt="Notion" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="favorite-fallback" style="display: none;">N</div>
                                </div>
                                <div class="favorite-label">Notion</div>
                            </div>
                            <div class="favorite-item" data-url="http://cursor.com">
                                <div class="favorite-icon">
                                    <img src="https://www.google.com/s2/favicons?domain=cursor.com&sz=64" alt="Cursor AI" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="favorite-fallback" style="display: none;">C</div>
                                </div>
                                <div class="favorite-label">Cursor AI</div>
                            </div>
                        </div>
                    </div>
                    <div class="web-iframe-container" id="webIframeContainer" style="display: none;">
                        <iframe id="webIframe" src="" style="width: 100%; height: 100%; border: none;" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"></iframe>
                    </div>
                </div>
                <div class="window-resize-handle nw" data-window="webWindow" data-direction="nw"></div>
                <div class="window-resize-handle ne" data-window="webWindow" data-direction="ne"></div>
                <div class="window-resize-handle sw" data-window="webWindow" data-direction="sw"></div>
                <div class="window-resize-handle se" data-window="webWindow" data-direction="se"></div>
                <div class="window-resize-handle n" data-window="webWindow" data-direction="n"></div>
                <div class="window-resize-handle s" data-window="webWindow" data-direction="s"></div>
                <div class="window-resize-handle w" data-window="webWindow" data-direction="w"></div>
                <div class="window-resize-handle e" data-window="webWindow" data-direction="e"></div>
            </div>
        </div>
        
        <!-- Settings Window -->
        <div class="window minimized" id="settingsWindow" style="top: 80px; left: 200px; width: 700px; height: 400px;">
            <div class="title-bar" id="settingsTitleBar">
                <div class="window-controls">
                    <div class="window-btn close" data-window="settingsWindow"></div>
                    <div class="window-btn maximize" data-window="settingsWindow"></div>
                </div>
                <div class="window-title">Settings</div>
                <div style="width: 36px;"></div>
            </div>
            <div class="settings-content">
                <div class="settings-tabs">
                    <div class="settings-tab active" data-tab="themes">Themes</div>
                </div>
                <div class="settings-panel" id="themesPanel">
                    <div class="settings-section">
                        <h3>Wallpaper</h3>
                        <div class="wallpaper-options">
                            <div class="wallpaper-option" data-wallpaper="vibrant">
                                <div class="wallpaper-preview vibrant-preview"></div>
                                <div class="wallpaper-label">Vibrant Abstract</div>
                            </div>
                            <div class="wallpaper-option" data-wallpaper="black">
                                <div class="wallpaper-preview black-preview"></div>
                                <div class="wallpaper-label">Black</div>
                            </div>
                            <div class="wallpaper-option" data-wallpaper="gray">
                                <div class="wallpaper-preview gray-preview"></div>
                                <div class="wallpaper-label">Gray</div>
                            </div>
                            <div class="wallpaper-option" data-wallpaper="pastel">
                                <div class="wallpaper-preview pastel-preview"></div>
                                <div class="wallpaper-label">Pastel Gradient</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="window-resize-handle nw" data-window="settingsWindow" data-direction="nw"></div>
                <div class="window-resize-handle ne" data-window="settingsWindow" data-direction="ne"></div>
                <div class="window-resize-handle sw" data-window="settingsWindow" data-direction="sw"></div>
                <div class="window-resize-handle se" data-window="settingsWindow" data-direction="se"></div>
                <div class="window-resize-handle n" data-window="settingsWindow" data-direction="n"></div>
                <div class="window-resize-handle s" data-window="settingsWindow" data-direction="s"></div>
                <div class="window-resize-handle w" data-window="settingsWindow" data-direction="w"></div>
                <div class="window-resize-handle e" data-window="settingsWindow" data-direction="e"></div>
            </div>
        </div>
    </div>
    
    <!-- Music Window -->
    <div class="window minimized" id="musicWindow" style="top: 80px; left: 200px; width: 600px; height: 500px;">
        <div class="title-bar" id="musicTitleBar">
            <div class="window-controls">
                <div class="window-btn close" data-window="musicWindow"></div>
                <div class="window-btn maximize" data-window="musicWindow"></div>
            </div>
            <div class="window-title">Music</div>
            <div style="width: 36px;"></div>
        </div>
        <div class="music-content">
            <div class="music-player">
                <div class="video-section">
                    <div class="video-container">
                        <iframe id="musicVideo" src="" frameborder="0" allowfullscreen></iframe>
                    </div>
                </div>
                <div class="music-controls">
                    <div class="track-info">
                        <div class="track-title" id="currentTrackTitle">Loading...</div>
                        <div class="track-artist" id="currentTrackArtist">Loading...</div>
                    </div>
                    <div class="control-buttons">
                        <button class="control-btn play-btn" id="playBtn">‚ñ∂</button>
                        <button class="control-btn pause-btn" id="pauseBtn">‚è∏</button>
                        <button class="control-btn prev-btn" id="prevBtn">‚èÆ</button>
                        <button class="control-btn next-btn" id="nextBtn">‚è≠</button>
                    </div>
                </div>
            </div>
            <div class="window-resize-handle nw" data-window="musicWindow" data-direction="nw"></div>
            <div class="window-resize-handle ne" data-window="musicWindow" data-direction="ne"></div>
            <div class="window-resize-handle sw" data-window="musicWindow" data-direction="sw"></div>
            <div class="window-resize-handle se" data-window="musicWindow" data-direction="se"></div>
            <div class="window-resize-handle n" data-window="musicWindow" data-direction="n"></div>
            <div class="window-resize-handle s" data-window="musicWindow" data-direction="s"></div>
            <div class="window-resize-handle w" data-window="musicWindow" data-direction="w"></div>
            <div class="window-resize-handle e" data-window="musicWindow" data-direction="e"></div>
        </div>
    </div>
            
    <!-- Dock -->
    <div class="dock">
        <div class="dock-item" id="webDockIcon" data-window="webWindow" title="Web">
            <div class="dock-label">Web</div>
        </div>
        <div class="dock-item" id="musicDockIcon" data-window="musicWindow" title="Music">
            <div class="dock-label">Music</div>
        </div>
        <div class="dock-item" id="oykunaiDockIcon" data-window="oykunaiWindow" title="Chat">
            <div class="dock-label">Chat</div>
        </div>
    </div>
    
    <script>
        // Update time
        function updateTime() {
            const now = new Date();
            // Convert to London time (Europe/London timezone)
            const londonTime = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/London' }));
            const hours = String(londonTime.getHours()).padStart(2, '0');
            const minutes = String(londonTime.getMinutes()).padStart(2, '0');
            const seconds = londonTime.getSeconds();
            // Blink colon with seconds (show on even seconds, hide on odd)
            const colon = seconds % 2 === 0 ? ':' : ' ';
            document.getElementById('menuTime').textContent = `${hours}${colon}${minutes} London, UK`;
        }
        updateTime();
        setInterval(updateTime, 1000);
        
        
        // Oykun OS dropdown functionality
        const oykunOSMenu = document.getElementById('oykunOSMenu');
        const oykunOSDropdown = document.getElementById('oykunOSDropdown');
        
        oykunOSMenu.addEventListener('click', (e) => {
            e.stopPropagation();
            oykunOSDropdown.classList.toggle('show');
        });
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!oykunOSMenu.contains(e.target)) {
                oykunOSDropdown.classList.remove('show');
            }
        });
        
        
        // About and Settings functions
        function openAbout() {
            oykunOSDropdown.classList.remove('show');
            const aboutWindow = document.getElementById('aboutWindow');
            aboutWindow.classList.remove('minimized');
            bringToFront(aboutWindow);
        }
        
        function openSettings() {
            oykunOSDropdown.classList.remove('show');
            const settingsWindow = document.getElementById('settingsWindow');
            settingsWindow.classList.remove('minimized');
            bringToFront(settingsWindow);
        }
        
        
        // Make all windows draggable
        const windows = {
            oykunaiWindow: document.getElementById('oykunaiWindow'),
            mailWindow: document.getElementById('mailWindow'),
            aboutWindow: document.getElementById('aboutWindow'),
            webWindow: document.getElementById('webWindow'),
            musicWindow: document.getElementById('musicWindow'),
            settingsWindow: document.getElementById('settingsWindow')
        };
        
        const titleBars = {
            oykunaiWindow: document.getElementById('oykunaiTitleBar'),
            mailWindow: document.getElementById('mailTitleBar'),
            aboutWindow: document.getElementById('aboutTitleBar'),
            webWindow: document.getElementById('webTitleBar'),
            musicWindow: document.getElementById('musicTitleBar'),
            settingsWindow: document.getElementById('settingsTitleBar')
        };
        
        let dragState = {};
        
        // Bring window to front
        function bringToFront(windowEl) {
            Object.values(windows).forEach(w => w.classList.remove('active'));
            windowEl.classList.add('active');
        }
        
        Object.keys(titleBars).forEach(windowId => {
            const titleBar = titleBars[windowId];
            const windowEl = windows[windowId];
            
            dragState[windowId] = {
                isDragging: false,
                currentX: 0,
                currentY: 0,
                initialX: 0,
                initialY: 0,
                xOffset: 0,
                yOffset: 0
            };
            
            // Bring to front on any click on the window
            windowEl.addEventListener('mousedown', () => {
                bringToFront(windowEl);
            });
            
            titleBar.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('window-btn')) return;
                const state = dragState[windowId];
                const rect = windowEl.getBoundingClientRect();
                state.initialX = e.clientX - rect.left;
                state.initialY = e.clientY - rect.top;
                state.isDragging = true;
                windowEl.classList.add('dragging');
            });
        });
        
        document.addEventListener('mousemove', (e) => {
            Object.keys(windows).forEach(windowId => {
                const state = dragState[windowId];
                const windowEl = windows[windowId];
                
                if (state.isDragging) {
                    e.preventDefault();
                    
                    // Calculate new position
                    let newX = e.clientX - state.initialX;
                    let newY = e.clientY - state.initialY;
                    
                    // Get window dimensions
                    const rect = windowEl.getBoundingClientRect();
                    const windowWidth = rect.width;
                    const windowHeight = rect.height;
                    
                    // Get viewport dimensions
                    const viewportWidth = window.innerWidth;
                    const viewportHeight = window.innerHeight;
                    
                    // Apply boundary constraints
                    newX = Math.max(0, Math.min(newX, viewportWidth - windowWidth));
                    newY = Math.max(0, Math.min(newY, viewportHeight - windowHeight));
                    
                    // Update position
                    windowEl.style.left = newX + 'px';
                    windowEl.style.top = newY + 'px';
                    windowEl.style.transform = 'none';
                }
            });
        });
        
        document.addEventListener('mouseup', () => {
            Object.keys(windows).forEach(windowId => {
                dragState[windowId].isDragging = false;
                windows[windowId].classList.remove('dragging');
            });
        });
        
        // Window controls (close, minimize, maximize)
        const windowStates = {};
        
        document.querySelectorAll('.window-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const windowId = btn.dataset.window;
                const windowEl = document.getElementById(windowId);
                
                if (btn.classList.contains('close')) {
                    windowEl.classList.add('minimized');
                    // Remove active state from dock when window is closed
                    const dockItem = document.querySelector(`.dock-item[data-window="${windowId}"]`);
                    console.log('Close button clicked for:', windowId, 'Found dock item:', dockItem);
                    if (dockItem) {
                        dockItem.classList.remove('active');
                        console.log('Removed active class from dock item');
                    }
                } else if (btn.classList.contains('minimize')) {
                    windowEl.classList.add('minimized');
                    // Remove active state from dock when window is minimized
                    const dockItem = document.querySelector(`.dock-item[data-window="${windowId}"]`);
                    if (dockItem) {
                        dockItem.classList.remove('active');
                    }
                } else if (btn.classList.contains('maximize')) {
                    if (!windowStates[windowId]) {
                        windowStates[windowId] = {
                            isMaximized: false,
                            beforeMaximize: {}
                        };
                    }
                    
                    if (!windowStates[windowId].isMaximized) {
                        windowStates[windowId].beforeMaximize = {
                            width: windowEl.style.width || getComputedStyle(windowEl).width,
                            height: windowEl.style.height || getComputedStyle(windowEl).height,
                            top: windowEl.style.top || getComputedStyle(windowEl).top,
                            left: windowEl.style.left || getComputedStyle(windowEl).left
                        };
                        windowEl.style.width = 'calc(100vw - 40px)';
                        windowEl.style.height = 'calc(100vh - 120px)';
                        windowEl.style.top = '40px';
                        windowEl.style.left = '50%';
                        windowEl.style.transform = 'translateX(-50%)';
                        windowStates[windowId].isMaximized = true;
                    } else {
                        const before = windowStates[windowId].beforeMaximize;
                        windowEl.style.width = before.width;
                        windowEl.style.height = before.height;
                        windowEl.style.top = before.top;
                        windowEl.style.left = before.left;
                        windowEl.style.transform = 'translateX(-50%)';
                        windowStates[windowId].isMaximized = false;
                    }
                }
            });
        });
        
        // Dock icons
        document.querySelectorAll('.dock-item[data-window]').forEach(icon => {
            icon.addEventListener('click', () => {
                const windowId = icon.dataset.window;
                const windowEl = document.getElementById(windowId);
                
                if (windowEl.classList.contains('minimized')) {
                    windowEl.classList.remove('minimized');
                    bringToFront(windowEl);
                    document.querySelectorAll('.dock-item').forEach(i => i.classList.remove('active'));
                    icon.classList.add('active');
                    
                    // Load default site for Web window
                    if (windowId === 'webWindow') {
                        loadDefaultSite();
                    }
                    
                    // Initialize music app for Music window
                    if (windowId === 'musicWindow') {
                        initMusicApp();
                    }
                } else {
                    windowEl.classList.add('minimized');
                    icon.classList.remove('active');
                }
            });
        });
        
        // Resizing
        let isResizing = false;
        let resizingWindow = null;
        let resizeDirection = null;
        let startX = 0;
        let startY = 0;
        let startWidth = 0;
        let startHeight = 0;
        let startLeft = 0;
        let startTop = 0;
        
        document.querySelectorAll('.window-resize-handle').forEach(handle => {
            handle.addEventListener('mousedown', (e) => {
                isResizing = true;
                const windowId = handle.dataset.window;
                const direction = handle.dataset.direction;
                resizingWindow = document.getElementById(windowId);
                resizeDirection = direction;
                
                const rect = resizingWindow.getBoundingClientRect();
                startX = e.clientX;
                startY = e.clientY;
                startWidth = rect.width;
                startHeight = rect.height;
                startLeft = rect.left;
                startTop = rect.top;
                
                e.stopPropagation();
            });
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isResizing && resizingWindow && resizeDirection) {
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                let newWidth = startWidth;
                let newHeight = startHeight;
                let newLeft = startLeft;
                let newTop = startTop;
                
                // Calculate new dimensions based on resize direction
                if (resizeDirection.includes('e')) { // east (right)
                    newWidth = startWidth + deltaX;
                }
                if (resizeDirection.includes('w')) { // west (left)
                    newWidth = startWidth - deltaX;
                    newLeft = startLeft + deltaX;
                }
                if (resizeDirection.includes('s')) { // south (bottom)
                    newHeight = startHeight + deltaY;
                }
                if (resizeDirection.includes('n')) { // north (top)
                    newHeight = startHeight - deltaY;
                    newTop = startTop + deltaY;
                }
                
                // Apply minimum size constraints
                if (newWidth > 300) {
                    resizingWindow.style.width = newWidth + 'px';
                    if (resizeDirection.includes('w')) {
                        resizingWindow.style.left = newLeft + 'px';
                    }
                }
                if (newHeight > 200) {
                    resizingWindow.style.height = newHeight + 'px';
                    if (resizeDirection.includes('n')) {
                        resizingWindow.style.top = newTop + 'px';
                    }
                }
            }
        });
        
        document.addEventListener('mouseup', () => {
            isResizing = false;
            resizingWindow = null;
            resizeDirection = null;
        });
        
        // Mail form submission
        document.getElementById('mailForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('.mail-send-btn');
            const statusDiv = document.getElementById('mailStatus');
            const from = document.getElementById('mailFrom').value;
            const subject = document.getElementById('mailSubject').value;
            const body = document.getElementById('mailBody').value;
            
            // Disable button and show sending status
            submitBtn.disabled = true;
            statusDiv.textContent = 'Sending...';
            statusDiv.className = 'mail-status';
            
            try {
                const response = await fetch('/api/send-mail', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        from,
                        to: 'hello@oykun.com',
                        subject,
                        body
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.textContent = '‚úì Message sent!';
                    statusDiv.className = 'mail-status success';
                    // Clear form
                    document.getElementById('mailFrom').value = '';
                    document.getElementById('mailSubject').value = '';
                    document.getElementById('mailBody').value = '';
                } else {
                    throw new Error(data.error || 'Failed to send');
                }
            } catch (error) {
                statusDiv.textContent = '‚úó Failed to send. Please try again.';
                statusDiv.className = 'mail-status error';
            } finally {
                submitBtn.disabled = false;
                // Clear status after 5 seconds
                setTimeout(() => {
                    statusDiv.textContent = '';
                    statusDiv.className = 'mail-status';
                }, 5000);
            }
        });
        
        // Settings window functionality
        // Tab switching
        document.querySelectorAll('.settings-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Hide all panels
                document.querySelectorAll('.settings-panel').forEach(panel => {
                    panel.style.display = 'none';
                });
                
                // Show selected panel
                const tabName = tab.dataset.tab;
                document.getElementById(tabName + 'Panel').style.display = 'block';
            });
        });
        
        // Wallpaper selection
        document.querySelectorAll('.wallpaper-option').forEach(option => {
            option.addEventListener('click', () => {
                // Remove selected class from all options
                document.querySelectorAll('.wallpaper-option').forEach(opt => opt.classList.remove('selected'));
                // Add selected class to clicked option
                option.classList.add('selected');
                
                // Change background based on selection
                const wallpaper = option.dataset.wallpaper;
                applyWallpaper(wallpaper);
                saveWallpaperSelection(wallpaper);
            });
        });
        
        // Wallpaper persistence functions
        function saveWallpaperSelection(wallpaper) {
            localStorage.setItem('oykunOS-wallpaper', wallpaper);
        }
        
        function loadWallpaperSelection() {
            return localStorage.getItem('oykunOS-wallpaper') || 'vibrant';
        }
        
        function applyWallpaper(wallpaper) {
            if (wallpaper === 'vibrant') {
                document.body.style.background = "url('assets/wallpapers/wallpaper.png') no-repeat center center fixed";
                document.body.style.backgroundSize = 'cover';
            } else if (wallpaper === 'black') {
                document.body.style.background = '#000000';
                document.body.style.backgroundSize = '';
            } else if (wallpaper === 'gray') {
                document.body.style.background = 'linear-gradient(135deg, #F5F5F5 0%, #ECECEC 25%, #E0E0E0 50%, #ECECEC 75%, #F5F5F5 100%)';
                document.body.style.backgroundSize = '';
            } else if (wallpaper === 'pastel') {
                document.body.style.background = 'linear-gradient(135deg, #FFE5E5 0%, #E5F3FF 50%, #F0E5FF 100%)';
                document.body.style.backgroundSize = '';
            }
        }
        
        // Load saved wallpaper on page load
        const savedWallpaper = loadWallpaperSelection();
        applyWallpaper(savedWallpaper);
        
        // Set saved wallpaper selection as active
        document.querySelectorAll('.wallpaper-option').forEach(opt => opt.classList.remove('selected'));
        const savedOption = document.querySelector(`.wallpaper-option[data-wallpaper="${savedWallpaper}"]`);
        if (savedOption) {
            savedOption.classList.add('selected');
        }
        
        // Web window functionality
        const webAddressInput = document.getElementById('webAddressInput');
        const webExternalBtn = document.getElementById('webExternalBtn');
        const webHomeBtn = document.getElementById('webHomeBtn');
        const webIframe = document.getElementById('webIframe');
        const webFavorites = document.getElementById('webFavorites');
        const webIframeContainer = document.getElementById('webIframeContainer');
        const webBackBtn = document.getElementById('webBackBtn');
        const webForwardBtn = document.getElementById('webForwardBtn');
        const webRefreshBtn = document.getElementById('webRefreshBtn');
        
        // Navigation history
        let webHistory = [];
        let currentHistoryIndex = -1;
        
        // Go to URL function
        function goToUrl(url) {
            if (!url) return;
            
            // Add protocol if missing
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            
            // Add to history
            webHistory = webHistory.slice(0, currentHistoryIndex + 1);
            webHistory.push(url);
            currentHistoryIndex = webHistory.length - 1;
            
            // Update UI
            webFavorites.style.display = 'none';
            webIframeContainer.style.display = 'block';
            
            // Show only the core domain in address bar
            try {
                const urlObj = new URL(url);
                const displayUrl = urlObj.hostname;
                webAddressInput.value = displayUrl;
            } catch (e) {
                webAddressInput.value = url;
            }
            
            // Use proxy for all URLs to bypass iframe restrictions
            tryProxyIframe(url);
            
            // Update navigation buttons
            updateNavButtons();
        }
        
        // Try proxy iframe loading
        function tryProxyIframe(url) {
            // Show loading message
            webIframeContainer.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 40px; text-align: center;">
                    <h3 style="color: #666; margin-bottom: 16px;">Loading via proxy...</h3>
                    <p style="color: #999; margin-bottom: 24px;">Fetching ${url}</p>
                    <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #FF3B30; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                </div>
            `;
            
            // Add CSS for spinner if not already added
            if (!document.getElementById('spinner-css')) {
                const style = document.createElement('style');
                style.id = 'spinner-css';
                style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
                document.head.appendChild(style);
            }
            
            // Create iframe with proxy URL
            const proxyUrl = `/api/proxy?url=${encodeURIComponent(url)}`;
            
            // Reset iframe container content
            webIframeContainer.innerHTML = `<iframe id="webIframe" src="${proxyUrl}" style="width: 100%; height: 100%; border: none;" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"></iframe>`;
            
            // Get the new iframe reference
            const newIframe = document.getElementById('webIframe');
            
            // Add load event listener
            newIframe.addEventListener('load', function() {
                console.log('Proxy iframe loaded successfully');
            }, { once: true });
            
            newIframe.addEventListener('error', function() {
                console.log('Proxy iframe failed to load');
                handleIframeError();
            }, { once: true });
        }
        
        // Try direct iframe loading (kept as fallback)
        function tryDirectIframe(url) {
            // Reset iframe container content
            webIframeContainer.innerHTML = '<iframe id="webIframe" src="" style="width: 100%; height: 100%; border: none;" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"></iframe>';
            
            // Get the new iframe reference
            const newIframe = document.getElementById('webIframe');
            
            // Set iframe src
            newIframe.src = url;
            
            // Check if content loads
            checkIframeLoad();
        }
        
        
        // Update navigation buttons
        function updateNavButtons() {
            webBackBtn.disabled = currentHistoryIndex <= 0;
            webForwardBtn.disabled = currentHistoryIndex >= webHistory.length - 1;
        }
        
        // Handle iframe loading errors
        function handleIframeError() {
            const currentUrl = webAddressInput.value;
            if (currentUrl) {
                // Show message that site can't be loaded in iframe
                webIframeContainer.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 40px; text-align: center;">
                        <h3 style="color: #666; margin-bottom: 16px;">This site can't be displayed in the browser</h3>
                        <p style="color: #999; margin-bottom: 24px;">Some websites block being loaded in iframes for security reasons.</p>
                        <div style="display: flex; gap: 12px;">
                            <button onclick="showFavorites()" style="padding: 12px 24px; background: #F0F0F0; color: #333; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                                Back to Favorites
                            </button>
                            <button onclick="document.getElementById('webExternalBtn').click()" style="padding: 12px 24px; background: #FF3B30; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                                Open Externally
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        // Note: iframe event listeners are now added dynamically in checkIframeLoad()
        
        // Check if iframe content is blocked after a delay
        let iframeLoadTimeout;
        let iframeLoaded = false;
        
        function checkIframeLoad() {
            iframeLoaded = false;
            clearTimeout(iframeLoadTimeout);
            
            // Add load event listener to the iframe
            const iframe = document.getElementById('webIframe');
            if (iframe) {
                iframe.addEventListener('load', function() {
                    iframeLoaded = true;
                    console.log('Iframe loaded successfully');
                }, { once: true });
                
                iframe.addEventListener('error', function() {
                    console.log('Iframe failed to load');
                    handleIframeError();
                }, { once: true });
            }
            
            // Only show error if iframe hasn't loaded after 5 seconds
            iframeLoadTimeout = setTimeout(() => {
                if (!iframeLoaded && webIframeContainer.style.display !== 'none') {
                    console.log('Iframe timeout - checking if content is accessible');
                    try {
                        const iframe = document.getElementById('webIframe');
                        if (iframe && iframe.contentDocument === null) {
                            console.log('Iframe content blocked - showing error');
                            handleIframeError();
                        }
                    } catch (e) {
                        console.log('Iframe access blocked - showing error');
                        handleIframeError();
                    }
                }
            }, 5000);
        }
        
        // Home button click
        webHomeBtn.addEventListener('click', () => {
            showFavorites();
        });
        
        // External button click - open in new window
        webExternalBtn.addEventListener('click', () => {
            const url = webAddressInput.value;
            if (url) {
                let fullUrl = url;
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    fullUrl = 'https://' + url;
                }
                window.open(fullUrl, '_blank');
            }
        });
        
        // Enter key in address bar
        webAddressInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                goToUrl(webAddressInput.value);
            }
        });
        
        // Navigation buttons
        webBackBtn.addEventListener('click', () => {
            if (currentHistoryIndex > 0) {
                currentHistoryIndex--;
                const url = webHistory[currentHistoryIndex];
                
                // Show only the core domain in address bar
                try {
                    const urlObj = new URL(url);
                    const displayUrl = urlObj.hostname;
                    webAddressInput.value = displayUrl;
                } catch (e) {
                    webAddressInput.value = url;
                }
                
                tryProxyIframe(url);
                updateNavButtons();
            }
        });
        
        webForwardBtn.addEventListener('click', () => {
            if (currentHistoryIndex < webHistory.length - 1) {
                currentHistoryIndex++;
                const url = webHistory[currentHistoryIndex];
                
                // Show only the core domain in address bar
                try {
                    const urlObj = new URL(url);
                    const displayUrl = urlObj.hostname;
                    webAddressInput.value = displayUrl;
                } catch (e) {
                    webAddressInput.value = url;
                }
                
                tryProxyIframe(url);
                updateNavButtons();
            }
        });
        
        webRefreshBtn.addEventListener('click', () => {
            // Get the full URL from history instead of the displayed domain
            if (currentHistoryIndex >= 0 && webHistory[currentHistoryIndex]) {
                const fullUrl = webHistory[currentHistoryIndex];
                tryProxyIframe(fullUrl);
            }
        });
        
        // Favorite items click (main favorites grid)
        document.querySelectorAll('.favorite-item').forEach(item => {
            item.addEventListener('click', () => {
                const url = item.dataset.url;
                goToUrl(url);
            });
        });
        
        // Favorites bar items click
        document.querySelectorAll('.fav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const url = link.dataset.url;
                goToUrl(url);
            });
        });
        
        // Tools folder functionality
        const toolsFolderHeader = document.getElementById('toolsFolderHeader');
        const toolsFolderContent = document.getElementById('toolsFolderContent');
        const toolsFolder = toolsFolderHeader.parentElement;
        
        toolsFolderHeader.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const isOpen = toolsFolderContent.style.display !== 'none';
            
            if (isOpen) {
                toolsFolderContent.style.display = 'none';
                toolsFolder.classList.remove('open');
            } else {
                toolsFolderContent.style.display = 'block';
                toolsFolder.classList.add('open');
            }
        });
        
        // Close folder when clicking outside
        document.addEventListener('click', (e) => {
            if (!toolsFolder.contains(e.target)) {
                toolsFolderContent.style.display = 'none';
                toolsFolder.classList.remove('open');
            }
        });
        
        // Close folder when clicking on any fav-link in the dropdown
        document.querySelectorAll('.fav-folder-content .fav-link').forEach(link => {
            link.addEventListener('click', () => {
                toolsFolderContent.style.display = 'none';
                toolsFolder.classList.remove('open');
            });
        });
        
        // Show favorites when iframe is hidden
        function showFavorites() {
            webFavorites.style.display = 'block';
            webIframeContainer.style.display = 'none';
            webAddressInput.value = '';
        }
        
        // Load crucial.design by default when Web window opens
        function loadDefaultSite() {
            goToUrl('https://crucial.design');
        }
        
        // Handle messages from error pages
        window.addEventListener('message', function(event) {
            if (event.data === 'openExternal') {
                const currentUrl = webAddressInput.value;
                if (currentUrl) {
                    window.open(currentUrl, '_blank');
                }
            } else if (event.data === 'goHome') {
                showFavorites();
            }
        });
        
    // Music Player functionality
    const musicVideo = document.getElementById('musicVideo');
    const currentVideoTitle = document.getElementById('currentVideoTitle');
    const currentTrackTitle = document.getElementById('currentTrackTitle');
    const currentTrackArtist = document.getElementById('currentTrackArtist');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressFill = document.getElementById('progressFill');
    const timeDisplay = document.getElementById('timeDisplay');
    
    // Music playlist
    const playlist = [
        {
            id: 'z_6EJDeZzWM',
            title: 'Grateful',
            artist: 'Mark Eliyahu',
            url: 'https://www.youtube.com/embed/z_6EJDeZzWM?enablejsapi=1&controls=0&showinfo=0&rel=0&modestbranding=1&disablekb=1&fs=0&iv_load_policy=3&cc_load_policy=0'
        },
        {
            id: 'G5y6LCmuWag',
            title: 'Music Video 2', 
            artist: 'Unknown Artist',
            url: 'https://www.youtube.com/embed/G5y6LCmuWag?enablejsapi=1&controls=0&showinfo=0&rel=0&modestbranding=1&disablekb=1&fs=0&iv_load_policy=3&cc_load_policy=0'
        }
    ];
    
    let currentTrackIndex = 0;
    let isPlaying = false;
    let currentTime = 0;
    let duration = 0;
    let player = null;
    
    // Initialize music player
    function initMusicPlayer() {
        // Set initial display first
        updateDisplay();
        
        // Load track immediately without delay
        loadTrackSimple();
    }
    
    // Setup YouTube API
    function setupYouTubeAPI() {
        // Load YouTube API if not already loaded
        if (!window.YT) {
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
        
        // Wait for API to load
        window.onYouTubeIframeAPIReady = function() {
            createPlayer();
        };
        
        // Fallback: if API doesn't load, use simple iframe
        setTimeout(() => {
            if (!window.YT) {
                loadTrackSimple();
            }
        }, 3000);
    }
    
    // Create YouTube player
    function createPlayer() {
        if (player) {
            player.destroy();
        }
        
        const track = playlist[currentTrackIndex];
        player = new YT.Player('musicVideo', {
            videoId: track.id,
            playerVars: {
                controls: 0,
                showinfo: 0,
                rel: 0,
                modestbranding: 1,
                autoplay: 1,
                disablekb: 1,
                fs: 0,
                iv_load_policy: 3,
                cc_load_policy: 0,
                playsinline: 1
            },
            events: {
                onReady: onPlayerReady,
                onStateChange: onPlayerStateChange
            }
        });
    }
    
    // Simple iframe loading
    function loadTrackSimple() {
        const track = playlist[currentTrackIndex];
        
        // Update display first
        updateDisplay();
        
        // Create a simple YouTube embed URL with autoplay
        const videoUrl = `https://www.youtube.com/embed/${track.id}?autoplay=1&controls=0&showinfo=0&rel=0&modestbranding=1&disablekb=1&fs=0&iv_load_policy=3&cc_load_policy=0`;
        
        // Load video directly
        musicVideo.src = videoUrl;
        
        // Set playing state
        isPlaying = true;
        playBtn.style.display = 'none';
        pauseBtn.style.display = 'inline-block';
        
        console.log('Loading track:', track.title, 'by', track.artist);
        console.log('Video URL:', videoUrl);
    }
    
    // Player ready callback
    function onPlayerReady(event) {
        duration = player.getDuration();
        updateProgress();
        startProgressUpdate();
        
        // Fetch video metadata
        fetchVideoMetadata();
    }
    
    // Fetch YouTube video metadata
    async function fetchVideoMetadata() {
        const track = playlist[currentTrackIndex];
        try {
            // Use YouTube oEmbed API to get video metadata
            const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${track.id}&format=json`);
            
            if (!response.ok) {
                throw new Error('Failed to fetch metadata');
            }
            
            const data = await response.json();
            
            // Extract title and try to parse artist
            const fullTitle = data.title;
            let title = fullTitle;
            let artist = 'Unknown Artist';
            
            // Try to parse "Artist - Song" format
            if (fullTitle.includes(' - ')) {
                const parts = fullTitle.split(' - ');
                if (parts.length >= 2) {
                    artist = parts[0].trim();
                    title = parts.slice(1).join(' - ').trim();
                }
            }
            
            // Update the playlist with real metadata
            playlist[currentTrackIndex].title = title;
            playlist[currentTrackIndex].artist = artist;
            
            // Update the display
            updateDisplay();
            
            console.log('Metadata updated:', title, 'by', artist);
            
        } catch (error) {
            console.log('Could not fetch metadata, using default values:', error.message);
            // Keep using the default values from playlist
        }
    }
    
    // Player state change callback
    function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.PLAYING) {
            isPlaying = true;
            playBtn.style.display = 'none';
            pauseBtn.style.display = 'inline-block';
        } else if (event.data === YT.PlayerState.PAUSED) {
            isPlaying = false;
            playBtn.style.display = 'inline-block';
            pauseBtn.style.display = 'none';
        } else if (event.data === YT.PlayerState.ENDED) {
            nextTrack();
        }
    }
    
    // Load a track
    function loadTrack(index) {
        if (index >= 0 && index < playlist.length) {
            currentTrackIndex = index;
            
            // Load new video using simple approach
            loadTrackSimple();
        }
    }
    
    // Play/Pause functionality
    function playMusic() {
        // For simple iframe mode, we can't control YouTube directly
        // But we can update the UI state
        isPlaying = true;
        playBtn.style.display = 'none';
        pauseBtn.style.display = 'inline-block';
        
        // Reload with autoplay
        const track = playlist[currentTrackIndex];
        const videoUrl = `https://www.youtube.com/embed/${track.id}?autoplay=1&controls=0&showinfo=0&rel=0&modestbranding=1&disablekb=1&fs=0&iv_load_policy=3&cc_load_policy=0`;
        musicVideo.src = videoUrl;
    }
    
    function pauseMusic() {
        // For simple iframe mode, we can't control YouTube directly
        // But we can update the UI state
        isPlaying = false;
        playBtn.style.display = 'inline-block';
        pauseBtn.style.display = 'none';
        
        // Reload without autoplay
        const track = playlist[currentTrackIndex];
        const videoUrl = `https://www.youtube.com/embed/${track.id}?autoplay=0&controls=0&showinfo=0&rel=0&modestbranding=1&disablekb=1&fs=0&iv_load_policy=3&cc_load_policy=0`;
        musicVideo.src = videoUrl;
    }
    
    // Navigation
    function nextTrack() {
        const nextIndex = (currentTrackIndex + 1) % playlist.length;
        loadTrack(nextIndex);
    }
    
    function prevTrack() {
        const prevIndex = currentTrackIndex === 0 ? playlist.length - 1 : currentTrackIndex - 1;
        loadTrack(prevIndex);
    }
    
    // Update display
    function updateDisplay() {
        const track = playlist[currentTrackIndex];
        if (currentTrackTitle) currentTrackTitle.textContent = track.title;
        if (currentTrackArtist) currentTrackArtist.textContent = track.artist;
        console.log('Updated display:', track.title, 'by', track.artist);
    }
    
    
    // Event listeners
    playBtn.addEventListener('click', playMusic);
    pauseBtn.addEventListener('click', pauseMusic);
    nextBtn.addEventListener('click', nextTrack);
    prevBtn.addEventListener('click', prevTrack);
    
    
    // Initialize music player when window opens
    function initMusicApp() {
        try {
            initMusicPlayer();
        } catch (error) {
            console.error('Music app initialization failed:', error);
            // Fallback: just update display
            updateDisplay();
        }
    }
    
        // System volume control
        
        // Initialize
        updateNavButtons();
        
        // Context Menu functionality
        const desktop = document.getElementById('desktop');
        const contextMenu = document.getElementById('contextMenu');
        const aboutContextItem = document.getElementById('aboutContextItem');
        const wallpaperContextItem = document.getElementById('wallpaperContextItem');
        
        // Show context menu on right-click
        desktop.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            
            // Don't show context menu if right-clicking on a window
            if (e.target.closest('.window')) {
                return;
            }
            
            // Position the context menu
            const x = e.clientX;
            const y = e.clientY;
            
            // Ensure menu stays within viewport
            const menuWidth = 160;
            const menuHeight = 80;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            let menuX = x;
            let menuY = y;
            
            if (x + menuWidth > viewportWidth) {
                menuX = x - menuWidth;
            }
            
            if (y + menuHeight > viewportHeight) {
                menuY = y - menuHeight;
            }
            
            contextMenu.style.left = menuX + 'px';
            contextMenu.style.top = menuY + 'px';
            contextMenu.style.display = 'block';
        });
        
        // Hide context menu on left-click
        document.addEventListener('click', (e) => {
            if (!contextMenu.contains(e.target)) {
                contextMenu.style.display = 'none';
            }
        });
        
        // Hide context menu on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                contextMenu.style.display = 'none';
            }
        });
        
        // Context menu item actions
        aboutContextItem.addEventListener('click', () => {
            contextMenu.style.display = 'none';
            openAbout();
        });
        
        wallpaperContextItem.addEventListener('click', () => {
            contextMenu.style.display = 'none';
            openSettings();
            // Switch to themes tab
            document.querySelector('.settings-tab[data-tab="themes"]').click();
        });
    </script>
</body>
</html>
